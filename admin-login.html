<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>后台管理 - 登录</title>
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://akqrebzfodejodgrtzyc.supabase.co",
  "sb_publishable_sCIqqs5zvkGT8ITvQNxQOQ_p2e2j5to"
);

async function adminLogin(){
  const key=document.getElementById("adminKey").value.trim();
  const pwd=document.getElementById("adminPassword").value.trim();
  const msg=document.getElementById("message");

  if(!key||!pwd){
    msg.textContent="请输入密钥和密码";
    msg.style.display="block";
    msg.className="message error";
    return;
  }

  let { data, error } = await supabase
    .from("admin")
    .select("admin_key, admin_password")
    .eq("id", 1)
    .single();

  if(error || !data){
    msg.textContent="管理员配置不存在";
    msg.style.display="block";
    msg.className="message error";
    return;
  }

  if(key===data.admin_key && pwd===data.admin_password){
    localStorage.setItem("admin_session", btoa(JSON.stringify({
      isAdmin:true,
      loginTime:Date.now()
    })));
    msg.textContent="登录成功，正在进入后台...";
    msg.className="message success";
    msg.style.display="block";
    setTimeout(()=>location.href="admin-panel.html",800);
  }else{
    msg.textContent="密钥或密码错误";
    msg.style.display="block";
    msg.className="message error";
  }
}
window.adminLogin=adminLogin;
</script>
<style>
body{background:#f4f4f4;font-family:sans-serif;padding:40px;}
.admin-login{max-width:400px;margin:auto;background:#fff;padding:30px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);}
input{width:100%;padding:12px;margin:8px 0;border-radius:6px;border:1px solid #ddd;}
button{width:100%;padding:12px;background:#667eea;border:none;color:#fff;border-radius:6px;cursor:pointer;}
.message{display:none;margin-top:10px;padding:10px;border-radius:6px;font-size:14px;}
.error{background:#ffe5e5;color:#b91c1c;}
.success{background:#e0f2fe;color:#075985;}
</style>
</head>
<body>
<div class="admin-login">
<h2>管理员登录</h2>
<input id="adminKey" placeholder="管理员密钥">
<input id="adminPassword" type="password" placeholder="管理员密码">
<button onclick="adminLogin()">登录后台</button>
<div id="message" class="message"></div>
</div>
</body>
</html>
