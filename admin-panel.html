<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>后台管理（Supabase迁移版 - 架构已生成，等你确认继续细化）</title>

<!--
⚠ 牢大注意：
这个文件不是最终版本！
这是 admin-panel.html 的 Supabase 迁移“骨架版”。
原因：你的后台文件超过 6000 行，系统会中断超长消息。

你说 A，我必须先生成后台消息管理的核心“可运行 Supabase 结构”。
你只要确认 OK，我就继续把全部功能（删除、搜索、日志、封禁等）分段补完并重新生成新的 zip。
-->

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// Supabase 初始化
const supabase = createClient(
  "https://akqrebzfodejodgrtzyc.supabase.co",
  "sb_publishable_sCIqqs5zvkGT8ITvQNxQOQ_p2e2j5to"
);

// 加载当前论坛消息
async function loadMessages(forum){
    const box = document.getElementById("msgList");
    box.innerHTML = "加载中...";

    let { data,error } = await supabase
        .from("messages")
        .select("*")
        .eq("forum", forum)
        .order("id",{ascending:true});

    if(error){
        box.innerHTML = "❌ 加载失败";
        return;
    }

    box.innerHTML = "";
    data.forEach(msg=>{
        let div = document.createElement("div");
        div.className = "msgItem";
        div.innerHTML = `
            <b>${msg.username}</b>：${msg.content}
            <button onclick="delMsg(${msg.id})">删除</button>
        `;
        box.appendChild(div);
    });
}

// 删除消息
async function delMsg(id){
    await supabase.from("messages").delete().eq("id",id);
    alert("删除成功");
    loadMessages(window.currentForum);
}

// 切换论坛
window.currentForum = "general";

window.onload = ()=>{
    loadMessages("general");
    document.getElementById("btnGeneral").onclick = ()=>{window.currentForum="general";loadMessages("general")};
    document.getElementById("btnStudy").onclick = ()=>{window.currentForum="study";loadMessages("study")};
    document.getElementById("btnFun").onclick   = ()=>{window.currentForum="fun";loadMessages("fun")};
};
</script>

<style>
body{background:#1a1a1a;color:white;font-family:sans-serif;padding:20px;}
.forumBtn{padding:8px 16px;margin:4px;border:none;background:#333;color:white;border-radius:6px;cursor:pointer;}
.msgItem{padding:10px;border-bottom:1px solid #333;margin-bottom:6px;}
button{cursor:pointer;}
</style>

</head>
<body>

<h2>后台管理（Supabase 消息管理模块骨架）</h2>

<div>
    <button id="btnGeneral" class="forumBtn">综合广场</button>
    <button id="btnStudy" class="forumBtn">学习广场</button>
    <button id="btnFun" class="forumBtn">娱乐广场</button>
</div>

<h3>消息列表</h3>
<div id="msgList">加载中...</div>

</body>
</html>
